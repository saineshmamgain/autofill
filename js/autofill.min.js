var options_default={onSelect:function(a,b){},onChange:function(a,b){},onFocusIn:function(){},render:function(a){var b="",c="";$(a).each(function(a,f){$.each(f,function(a,e){b+=" data-"+a+'="'+e+'" '});c+='<li class="autofill-list"'+b+">"+f.label+"</li>";b=""});return c},minScroll:6,minScrollHeight:"100px"};
$.fn.autofill=function(a){void 0==a&&(a=options_default);var b=$(this),c=b.attr("id"),d=b.data("autofill"),f=b.position(),g=$("<ul>"),e="autofill_list_"+c,h="";g.attr({id:e,"data-target":c,"class":"autofill-show"});g.css({width:b.width()+parseInt(b.css("padding-left"),10)+parseInt(b.css("padding-right"),10),position:"absolute",top:a.top?a.top:f.top+b.outerHeight(),left:-99999});$("#"+c).on("keyup",function(b){var c=$(this).val();if(c.length){var g=$.grep(d,function(d){try{if(-1!==d.label.search(new RegExp(c,
        "i")))return $(b.target).trigger("onChange",[c,d,a]),d}catch(f){$("#"+e).css("left",-99999)}});if(a.render||options_default.render)h=$.isFunction(a.render)?a.render(g):options_default.render(g)}else if(a.render||options_default.render)h=$.isFunction(a.render)?a.render(d):options_default.render(d);$("#"+e).html(h).css("left",a.left?a.left:f.left);$("#"+e).find("li").length>=(a.minScroll?a.minScroll:options_default.minScroll)&&$("#"+e).css({height:a.minScrollHeight?a.minScrollHeight:options_default.minScrollHeight,
    "overflow-y":"scroll"})}).on("focus",function(b){h="";$(this).val("");if(a.render||options_default.render)h=$.isFunction(a.render)?a.render(d):options_default.render(d);$("#"+e).html(h).css("left",a.left?a.left:f.left);$("#"+e).find("li").length>=(a.minScroll?a.minScroll:options_default.minScroll)&&$("#"+e).css({height:a.minScrollHeight?a.minScrollHeight:options_default.minScrollHeight,"overflow-y":"scroll"});$(b.target).trigger("onFocusIn",[a]);$(b.target).trigger("onChange",["",{},a])});b.after(g);
    $("#"+e).html(h);$(document).on("click",function(b){$(b.target).hasClass("autofill-list")&&$(b.target).parent("ul").data("target")==c?$(b.target).trigger("onSelect",[$(b.target).text(),$(b.target).data(),$(b.target).parent("ul"),$(b.target).parent("ul").data("target"),a]):$(b.target).attr("id")!==c&&$("#"+e).trigger("close")})};$(document).on("onSelect",".autofill-list",function(a,b,c,d,f,g){$("#"+f).val(b);$(d).css("left",-99999);if($.isFunction(g.onSelect))g.onSelect(c)});
$(document).on("onFocusIn",function(a,b){if($.isFunction(b.onFocusIn))b.onFocusIn()});$(document).on("onChange",function(a,b,c,d){if($.isFunction(d.onChange)){var f=new RegExp("^"+b+"$","gi");a=$(c).filter(function(a,b){return f.test(b.label)}).get();d.onChange(b,c,a[0]?a[0]:{})}});$(document).on("close",function(a){$(a.target).css("left",-99999)});