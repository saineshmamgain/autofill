var options_default={onSelect:function(a){},onChange:function(a,b,d){},onFocusIn:function(){},render:function(a){var b="",d="";$(a).each(function(a,e){$.each(e,function(a,d){b+=" data-"+a+'="'+d+'" '});d+='<li class="autofill-list"'+b+">"+e.label+"</li>";b=""});return d},minScroll:6,minScrollHeight:"100px"};
$.fn.autofill=function(a){void 0==a&&(a=options_default);var b=!0,d=$(this),c;d.attr("id")?c=d.attr("id"):(c="autofiil_input_"+(new Date).getTime(),d.attr("id",c));var e;$(document).on("autofillDataReceived","#"+c,function(e,h){var k=d.position(),l=$("<ul>"),f="autofill_list_"+c,g="",m=[];l.attr({id:f,"data-target":c,"class":"autofill-show"});l.css({width:d.width()+parseInt(d.css("padding-left"),10)+parseInt(d.css("padding-right"),10),position:"absolute",top:a.top?a.top:k.top+d.outerHeight(),left:-99999});
    b&&($("#"+c).on("keyup",function(d){var b=$(this).val();if(b.length){var c;void 0==m[b]?(c=$.grep(h,function(c){try{if(-1!==c.label.search(new RegExp(b,"i")))return $(d.target).trigger("onChange",[b,c,a]),c}catch(e){$("#"+f).css("left",-99999)}}),m[b]=c):(c=m[b],$(d.target).trigger("onChange",[b,c,a]));if(a.render||options_default.render)g=$.isFunction(a.render)?a.render(c):options_default.render(c)}else if(a.render||options_default.render)g=$.isFunction(a.render)?a.render(h):options_default.render(h);
        $("#"+f).html(g).css("left",a.left?a.left:k.left);$("#"+f).find("li").length>=(a.minScroll?a.minScroll:options_default.minScroll)?$("#"+f).css({height:a.minScrollHeight?a.minScrollHeight:options_default.minScrollHeight,"overflow-y":"scroll"}):$("#"+f).css({height:"auto","overflow-y":"unset"})}).on("focus",function(b){g="";$(this).val("");if(a.render||options_default.render)g=$.isFunction(a.render)?a.render(h):options_default.render(h);$("#"+f).html(g).css("left",a.left?a.left:k.left);$("#"+f).find("li").length>=
    (a.minScroll?a.minScroll:options_default.minScroll)?$("#"+f).css({height:a.minScrollHeight?a.minScrollHeight:options_default.minScrollHeight,"overflow-y":"scroll"}):$("#"+f).css({height:"auto","overflow-y":"unset"});$(b.target).trigger("onFocusIn",[a]);$(b.target).trigger("onChange",["",{},a])}),d.after(l),$("#"+f).html(g),$(document).on("click",function(b){"li"===b.target.tagName.toLowerCase()&&$(b.target).parent("ul").data("target")==c?$(b.target).trigger("onSelect",[$(b.target).text(),$(b.target).data(),
        $(b.target).parent("ul"),$(b.target).parent("ul").data("target"),a]):$(b.target).attr("id")!==c&&$("#"+f).trigger("close")}))});a.source&&void 0!==a.ajax&&!0===a.ajax?(b=!1,$.ajax({url:a.source,type:"GET",success:function(a){b=!0;e=a;$("#"+c).trigger("autofillDataReceived",[e])},error:function(){b=!1;throw Error("There was an error fetching data from server.");}})):(void 0!==a.source?(b=!0,e=JSON.parse(a.source)):(b=!0,e=d.data("autofill")),$("#"+c).trigger("autofillDataReceived",[e]))};
$(document).on("onSelect","li",function(a,b,d,c,e,n){$("#"+e).val(b);$(c).css("left",-99999);if($.isFunction(n.onSelect))n.onSelect(d)});$(document).on("onFocusIn",function(a,b){if($.isFunction(b.onFocusIn))b.onFocusIn()});$(document).on("onChange",function(a,b,d,c){if($.isFunction(c.onChange)){var e=new RegExp("^"+b+"$","gi");a=$(d).filter(function(a,b){return e.test(b.label)}).get();c.onChange(b,d,a[0]?a[0]:{})}});$(document).on("close",function(a){$(a.target).css("left",-99999)});